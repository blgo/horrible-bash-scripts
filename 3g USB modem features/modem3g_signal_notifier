#! /bin/bash
#show the signal strengh and band tipe, from a file, generated by reading ttyX?, using dd, to create a temporal file "signal_temp" (READ script missing...)
function mode {
MODE1="`cat ./scripts/signal_temp | sed '/MODE/!d' | tail -n 1 | awk '{print$2}' | sed 's/\,/\ /' | awk '{print$1}'`"
MODE2="`cat ./scripts/signal_temp | sed '/MODE/!d' | tail -n 1 | awk '{print$2}' | sed 's/\,/\ /' | awk '{print$2}'`"
if [ $MODE1 -eq 3 ] 
	then
    	if [ $MODE2 -eq 2 ] 
		then
      		MODE="G"
		else
    		if [ $MODE2 -eq 3 ]
			then
      			MODE="E"
		fi
	fi
	else
  	if [ $MODE1 -eq 5 ]
		then
    		if [ $MODE2 -eq 4 ]
			then
      			MODE="G"
			else
			if [ $MODE2 -eq 5 ]
				then
				MODE="H"
				else
				if [ $MODE2 -eq 9 ]
					then
					MODE="H"
				fi
			fi
		fi
	fi
fi
}


function signalstrength {
NUMBER="`cat ./scripts/signal_temp | sed '/RSSI/!d' | tail -n 1 | awk '{print$2}'`"
if [ $NUMBER -lt 5 ]
	then
		LVL="^fg(green)^p(;12)^r(6x2)^p(;-3)^r(6x5)^p(;-3)^ro(6x8)^p(;-3)^ro(6x11)^p(;-3)^ro(6x14)"
	else
	if [ $NUMBER -lt 10 ]
		then
		LVL="^fg(green)^p(;12)^r(6x2)^p(;-3)^r(6x5)^p(;-3)^ro(6x8)^p(;-3)^ro(6x11)^p(;-3)^ro(6x14)"
		else 
		if [ $NUMBER -lt 15 ]
			then
			LVL="^fg(green)^p(;12)^r(6x2)^p(;-3)^r(6x5)^p(;-3)^ro(6x8)^p(;-3)^ro(6x11)^p(;-3)^ro(6x14)"
			else
			if [ $NUMBER -lt 20 ]
				then
				LVL="^fg(green)^p(;12)^r(6x2)^p(;-3)^r(6x5)^p(;-3)^ro(6x8)^p(;-3)^ro(6x11) ^p(;-3)^ro(6x14)"
				else
				if [ $NUMBER -lt 30 ]
					then
					LVL="^fg(green)^p(;12)^r(6x2)^p(;-3)^r(6x5)^p(;-3)^ro(6x8)^p(;-3)^ro(6x11)^p(;-3)^ro(6x14)"
				fi
			fi
		fi
	fi
fi
}
(while true;
do
mode
signalstrength
echo "^bg(black)^fg(green)$MODE$LVL"
sleep 5
done) | dzen2 -expand left
