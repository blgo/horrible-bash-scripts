#!/bin/bash
#reads the ./.weatherforecast file, generated by download_weatherforecast script
#debug function, show the retrieved data

function debug {
if [ "$1" = "-d" ]
then
echo "line=$LINE"
echo "temperature=$TEMPERATURE"
echo "wind=$WIND"
echo "rain=$RAIN"
echo "clouds=$CLOUDS"
echo "numberoffiles=$NUMBEROFILES"
echo "dawn=$SUNSHINEHOUR:$SUNSHINEMINUTE"
echo "dusk=$SUNSETHOUR:$SUNSETMINUTE"
echo "numberoflines=$NUMBEROFLINES="
echo "amanecerline=$AMANECERLINE"
echo "amanecertime=$AMANECERTIME"
echo "ocasoline=$OCASOLINE"
echo "ocasotime=$OCASOTIME"
echo "day=$day"
echo "icon=$ICON"
echo ""
fi
}

function chooseicon {
DAY="`date +%_d`"
HOUR="`date +%_H`"
day=0
if [ "$HOUR" -ge "$SUNSHINEHOUR" ] && [ "$HOUR" -le "$SUNSETHOUR" ]
		then 
		day=1
		if [ "$HOUR" -eq "$SUNSHINEHOUR" ]
			then 
			if [ "$MINUTE" -ge "$SUNSHINEMINUTE" ] 
				then
				day=1
				else
				day=0
			fi		
		fi	
		if [ "$HOUR" -eq "$SUNSETHOUR" ]
			then
			if [ "$MINUTE" -le "$SUNSETMINUTE" ]
				then
				day=1
				else
				day=0
			fi
		fi
fi
vector=0
if [ "$day" -eq 1 ]
	then
	vector=$(( $vector + 1 ))
fi	
if [ "$CLOUDS" -ge 50 ]
	then
	vector=$(( $vector + 10  ))
	if [ "$RAIN" -gt 0 ]
		then
		vector=$(( $vector + 100  ))
	fi
fi

case "$vector" in
	0)	ICON=moon.png;;
	1)	ICON=sun.png;;
	10)	ICON=cloudmoon.png;;
	11)     ICON=suncloud.png;;
	110)	ICON=rainmoon.png;;
	111)	ICON=sunrain.png;;
esac
ICON="$ICON"
}

function isnumeric {
if [ -n "`echo $1 | sed 's/[0-9]//g'`" ]; then
    echo '1' #is not numeric 
else
    echo '0' #is numeric
fi
}

function notify {

if [ -n "$RAIN" ] && [ `isnumeric "$RAIN" ` -eq '0' ]
	then
		Lluvia="LLuvia=$RAIN mm"
	fi
if [ -n "$WIND" ] && [ `isnumeric "$WIND" ` -eq '0' ]
	then
		Viento="Viento:$WIND Km/h"
	fi
if [ -n "$TEMPERATURE" ] && [ `isnumeric "$TEMPERATURE"` -eq '0' ]
	then
		Temperatura="Temperatura: -- $TEMPERATUREÂºC"
		nubes="Nubes:$CLOUDS%"
	fi
if [ -n "$day" ] && [ $day -eq 1 ]
	then 
		daytime="day"
		COLOR="^fg(yellow)"
		else
		daytime="night"
		COLOR="^fg(white)"
	fi
if [ "$1" != "-echo"  ]
then
echo -e "$COLOR $(date +%H:%M\ \-\ %d\ %B\ %A) ^fg(green)$Temperatura $Viento $nubes $Lluvia" | dzen2 -p 5 -bg '#224466' &
fi
echo -e "$COLOR $(date +%d\ %B\ %A) $Temperatura $Viento $nubes "
}

DIR="$HOME/"
HOUR="`date +%_H`"
MINUTE="`date +%_M`"
MONTH="`date +%b`"
DAY="`date +%d`"
HOUR=$(( $HOUR + 1 ))
notify $1
debug $1
